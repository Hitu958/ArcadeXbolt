<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music â€” ArcadeX</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŽµ</text></svg>">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .player-card {
            background: linear-gradient(145deg, rgba(22, 22, 31, 0.8), rgba(139, 92, 246, 0.05));
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 30px;
            display: flex;
            gap: 30px;
            align-items: center;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(20px);
        }

        .album-art {
            width: 120px;
            height: 120px;
            border-radius: 16px;
            background: #000;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: #333;
            position: relative;
            transition: transform 0.5s ease;
        }

        .album-art.playing {
            animation: albumPulse 2s ease-in-out infinite;
        }

        @keyframes albumPulse {

            0%,
            100% {
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            }

            50% {
                box-shadow: 0 10px 40px rgba(139, 92, 246, 0.3), 0 10px 30px rgba(0, 0, 0, 0.5);
            }
        }

        .progress-container {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin-top: 15px;
            position: relative;
            cursor: pointer;
            transition: height 0.2s ease;
        }

        .progress-container:hover {
            height: 8px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--neon-purple));
            border-radius: 10px;
            position: relative;
            transition: width 0.3s linear;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            right: -4px;
            top: 50%;
            transform: translateY(-50%) scale(0);
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: white;
            box-shadow: 0 0 10px rgba(139, 92, 246, 0.5);
            transition: transform 0.2s ease;
        }

        .progress-container:hover .progress-bar::after {
            transform: translateY(-50%) scale(1);
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.1);
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        .control-btn.active {
            background: rgba(139, 92, 246, 0.2);
            border-color: rgba(139, 92, 246, 0.4);
            color: var(--accent-light);
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.2);
        }

        .control-btn.play {
            width: 56px;
            height: 56px;
            background: var(--accent);
            border-color: var(--accent);
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.4);
        }

        .control-btn.play:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(139, 92, 246, 0.6);
        }

        .control-btn.play:active {
            transform: scale(0.95);
        }

        .control-btn.play.paused {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
            box-shadow: none;
        }

        .queue-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .queue-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .queue-item.active {
            background: rgba(139, 92, 246, 0.1);
            border-color: rgba(139, 92, 246, 0.3);
        }

        .queue-item .remove-btn {
            opacity: 0;
            transition: opacity 0.2s;
        }

        .queue-item:hover .remove-btn {
            opacity: 1;
        }

        /* Equalizer animation */
        .eq-bars {
            display: flex;
            align-items: flex-end;
            gap: 2px;
            height: 16px;
        }

        .eq-bar {
            width: 3px;
            background: var(--accent-light);
            border-radius: 1px;
            animation: eqBounce 0.8s ease-in-out infinite;
        }

        .eq-bar:nth-child(1) {
            height: 60%;
            animation-delay: 0s;
        }

        .eq-bar:nth-child(2) {
            height: 100%;
            animation-delay: 0.2s;
        }

        .eq-bar:nth-child(3) {
            height: 40%;
            animation-delay: 0.4s;
        }

        .eq-bar:nth-child(4) {
            height: 80%;
            animation-delay: 0.1s;
        }

        .eq-bars.paused .eq-bar {
            animation: none;
            height: 3px !important;
        }

        @keyframes eqBounce {

            0%,
            100% {
                transform: scaleY(0.4);
            }

            50% {
                transform: scaleY(1);
            }
        }

        /* Volume slider */
        input[type="range"].volume-slider {
            -webkit-appearance: none;
            appearance: none;
            height: 4px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 2px;
            outline: none;
            transition: all 0.2s;
        }

        input[type="range"].volume-slider:hover {
            height: 6px;
        }

        input[type="range"].volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 0 8px rgba(139, 92, 246, 0.4);
        }
    </style>
</head>

<body>
    <nav class="navbar">
        <div class="container" style="max-width:1600px;padding:0 40px">
            <a href="index.html" class="navbar-brand"><i data-lucide="zap"
                    style="color:var(--accent);fill:var(--accent-glow)"></i>ArcadeX</a>
            <div class="navbar-actions">
                <a href="dashboard.html" class="btn btn-secondary btn-sm"><i data-lucide="arrow-left" size="16"></i>
                    Dashboard</a>
            </div>
        </div>
    </nav>

    <div class="dashboard-layout">
        <aside class="sidebar">
            <div class="sidebar-section-title">Main</div>
            <a href="dashboard.html" class="sidebar-link"><i data-lucide="layout-dashboard"></i> Overview</a>
            <a href="servers.html" class="sidebar-link"><i data-lucide="server"></i> My Servers</a>

            <div class="sidebar-section-title">Tools</div>
            <a href="embed-builder.html" class="sidebar-link"><i data-lucide="box"></i> Embed Builder</a>
            <a href="welcome-builder.html" class="sidebar-link"><i data-lucide="image"></i> Welcome Cards</a>

            <div class="sidebar-section-title">Manage</div>
            <a href="automod.html" class="sidebar-link"><i data-lucide="shield"></i> Auto Mod</a>
            <a href="music.html" class="sidebar-link active"><i data-lucide="music"></i> Music</a>
            <a href="economy.html" class="sidebar-link"><i data-lucide="coins"></i> Economy</a>
            <a href="leveling.html" class="sidebar-link"><i data-lucide="trophy"></i> Leveling</a>
            <a href="tickets.html" class="sidebar-link"><i data-lucide="ticket"></i> Tickets</a>
            <a href="giveaways.html" class="sidebar-link"><i data-lucide="gift"></i> Giveaways</a>

            <div
                style="margin-top:40px;padding:24px;background:linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(0,0,0,0));border-radius:20px;border:1px solid var(--border)">
                <div class="flex items-center gap-sm mb-2"
                    style="margin-bottom:8px;color:var(--accent-light);font-weight:700">
                    <i data-lucide="crown" size="16"></i> Go Premium
                </div>
                <p style="font-size:0.85rem;margin-bottom:16px;color:var(--text-secondary)">High quality audio.</p>
                <a href="premium.html" class="btn btn-primary btn-sm w-full"
                    style="box-shadow:0 4px 15px var(--accent-glow)">Upgrade</a>
            </div>
        </aside>

        <main class="dashboard-main fade-in-up">
            <div style="margin-bottom:32px;display:flex;justify-content:space-between;align-items:end">
                <div>
                    <h1 style="font-size:2rem;margin-bottom:8px">ðŸŽµ <span class="gradient-text">Music Player</span></h1>
                    <p style="color:var(--text-secondary)">Manage playback, queue, and filters.</p>
                </div>
                <div class="form-group" style="margin-bottom:0;width:250px">
                    <select class="form-select">
                        <option>My Server</option>
                        <option>Test Server</option>
                    </select>
                </div>
            </div>

            <div class="player-card mb-8">
                <div
                    style="position:absolute;top:0;left:0;right:0;bottom:0;z-index:0;background:radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.15), transparent 50%)">
                </div>
                <div class="album-art playing" id="album-art"
                    style="z-index:1;background-image:url('https://images.unsplash.com/photo-1470225620780-dba8ba36b745?w=500&q=80');background-size:cover">
                </div>

                <div style="flex:1;z-index:1">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h2 style="font-size:1.5rem;margin-bottom:4px;display:flex;align-items:center;gap:10px"
                                id="track-title">
                                Midnight City
                                <div class="eq-bars" id="eq-bars">
                                    <div class="eq-bar"></div>
                                    <div class="eq-bar"></div>
                                    <div class="eq-bar"></div>
                                    <div class="eq-bar"></div>
                                </div>
                            </h2>
                            <p style="color:var(--text-secondary);font-size:1rem" id="track-artist">M83 â€¢ Hurry Up,
                                We're Dreaming</p>
                        </div>

                    </div>

                    <div class="progress-container" onclick="seek(event)">
                        <div class="progress-bar" id="progress-bar" style="width:35%"></div>
                    </div>
                    <div class="flex justify-between"
                        style="margin-top:8px;font-size:0.8rem;color:var(--text-secondary)">
                        <span id="current-time">1:24</span>
                        <span id="total-time">4:03</span>
                    </div>

                    <div class="flex items-center gap-lg" style="margin-top:20px">
                        <div class="flex gap-md items-center">
                            <button class="control-btn" id="shuffle-btn" title="Shuffle"
                                onclick="toggleShuffle(this)"><i data-lucide="shuffle" size="18"></i></button>
                            <button class="control-btn" title="Previous" onclick="prevTrack()"><i
                                    data-lucide="skip-back" size="20"></i></button>
                            <button class="control-btn play" id="play-btn" title="Play/Pause" onclick="togglePlay()">
                                <i data-lucide="pause" size="24" fill="white" id="play-icon"></i>
                            </button>
                            <button class="control-btn" title="Next" onclick="nextTrack()"><i data-lucide="skip-forward"
                                    size="20"></i></button>
                            <button class="control-btn" id="loop-btn" title="Loop" onclick="toggleLoop(this)"><i
                                    data-lucide="repeat" size="18"></i></button>
                        </div>
                        <div style="width:1px;height:30px;background:rgba(255,255,255,0.1)"></div>
                        <div class="flex items-center gap-sm">
                            <i data-lucide="volume-2" size="18" style="color:var(--text-secondary)"
                                id="volume-icon"></i>
                            <input type="range" class="volume-slider" style="width:80px" value="75" min="0" max="100"
                                oninput="updateVolume(this.value)">
                            <span style="font-size:0.75rem;color:var(--text-secondary);min-width:28px"
                                id="volume-val">75%</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="settings-layout">
                <div>
                    <div class="card" style="min-height:400px">
                        <div class="flex justify-between items-center mb-4">
                            <h4 style="font-size:1.2rem">Up Next</h4>
                            <button class="btn btn-secondary btn-sm" onclick="clearQueue()">Clear Queue</button>
                        </div>
                        <div id="queue-list" class="flex flex-col gap-sm">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

                <div>
                    <div class="card mb-4" style="position:sticky;top:100px">
                        <h4 style="margin-bottom:16px">Add to Queue</h4>
                        <div class="form-group">
                            <input type="text" class="form-input" id="music-url" placeholder="Paste URL or search..."
                                onkeydown="if(event.key==='Enter') addToQueue()">
                        </div>
                        <button class="btn btn-primary w-full" onclick="addToQueue()"><i data-lucide="plus"></i> Add to
                            Queue</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="js/mesh-bg.js"></script>
    <script src="js/premium.js"></script>
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/utils.js"></script>
    <script>
        lucide.createIcons();
        MeshBG.init(document.body);

        let isPlaying = true;
        let isShuffling = false;
        let isLooping = false;
        let progressPercent = 35;
        let progressInterval = null;
        let currentSeconds = 84; // 1:24
        const totalSeconds = 243; // 4:03

        // Queue data
        const queue = [
            { title: 'Midnight City', artist: 'M83', duration: '4:03', img: 'https://images.unsplash.com/photo-1470225620780-dba8ba36b745?w=100&q=80', active: true },
            { title: 'Blinding Lights', artist: 'The Weeknd', duration: '3:20', img: 'https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=100&q=80', active: false },
            { title: 'Starboy', artist: 'The Weeknd', duration: '3:50', img: 'https://images.unsplash.com/photo-1514525253161-7a46d19cd819?w=100&q=80', active: false },
        ];

        renderQueue();
        startProgress();

        function renderQueue() {
            const list = document.getElementById('queue-list');
            if (!queue.length) {
                list.innerHTML = '<p style="color:var(--text-secondary);text-align:center;padding:40px;font-size:0.9rem">Queue is empty. Add some tracks!</p>';
                return;
            }
            list.innerHTML = '';
            queue.forEach((item, idx) => {
                const el = document.createElement('div');
                el.className = 'queue-item' + (item.active ? ' active' : '');
                el.onclick = () => playTrack(idx);
                el.innerHTML = `
                    <span style="font-size:0.9rem;color:${item.active ? 'var(--accent-light)' : 'var(--text-secondary)'};font-weight:700;min-width:20px">${idx + 1}</span>
                    <img src="${item.img}" style="width:40px;height:40px;border-radius:6px;object-fit:cover" onerror="this.style.display='none'">
                    <div style="flex:1;min-width:0">
                        <h4 style="font-size:0.95rem;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${item.title}</h4>
                        <p style="font-size:0.8rem;color:var(--text-secondary)">${item.artist}</p>
                    </div>
                    <span style="font-size:0.85rem;color:var(--text-secondary)">${item.duration}</span>
                    <button class="btn btn-secondary btn-sm remove-btn" onclick="event.stopPropagation(); removeFromQueue(${idx})" style="padding:4px;border:none;background:transparent;color:var(--text-secondary)"><i data-lucide="x" size="14"></i></button>
                `;
                list.appendChild(el);
            });
            lucide.createIcons();
        }

        function playTrack(idx) {
            queue.forEach((item, i) => item.active = i === idx);
            const track = queue[idx];
            document.getElementById('track-title').innerHTML = track.title + ' <div class="eq-bars" id="eq-bars"><div class="eq-bar"></div><div class="eq-bar"></div><div class="eq-bar"></div><div class="eq-bar"></div></div>';
            document.getElementById('track-artist').textContent = track.artist;
            document.getElementById('album-art').style.backgroundImage = `url('${track.img.replace('w=100', 'w=500')}')`;

            // Reset progress
            progressPercent = 0;
            currentSeconds = 0;
            isPlaying = true;
            updatePlayButton();
            startProgress();
            renderQueue();
            Utils.toast(`Now playing: ${track.title}`, 'info');
        }

        function togglePlay() {
            isPlaying = !isPlaying;
            updatePlayButton();
            if (isPlaying) {
                startProgress();
                Utils.toast('Resumed playback');
            } else {
                stopProgress();
                Utils.toast('Paused playback');
            }
        }

        function updatePlayButton() {
            const btn = document.getElementById('play-btn');
            const icon = document.getElementById('play-icon');
            const art = document.getElementById('album-art');
            const eq = document.getElementById('eq-bars');

            if (isPlaying) {
                icon.setAttribute('data-lucide', 'pause');
                btn.classList.remove('paused');
                art.classList.add('playing');
                if (eq) eq.classList.remove('paused');
            } else {
                icon.setAttribute('data-lucide', 'play');
                btn.classList.add('paused');
                art.classList.remove('playing');
                if (eq) eq.classList.add('paused');
            }
            icon.setAttribute('fill', 'white');
            lucide.createIcons();
        }

        function startProgress() {
            stopProgress();
            progressInterval = setInterval(() => {
                if (isPlaying && progressPercent < 100) {
                    progressPercent += 0.15;
                    currentSeconds += 0.36;
                    document.getElementById('progress-bar').style.width = progressPercent + '%';
                    const mins = Math.floor(currentSeconds / 60);
                    const secs = Math.floor(currentSeconds % 60);
                    document.getElementById('current-time').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
                } else if (progressPercent >= 100) {
                    nextTrack();
                }
            }, 250);
        }

        function stopProgress() {
            if (progressInterval) clearInterval(progressInterval);
        }

        function nextTrack() {
            const currentIdx = queue.findIndex(i => i.active);
            const nextIdx = (currentIdx + 1) % queue.length;
            if (queue.length) playTrack(nextIdx);
        }

        function prevTrack() {
            const currentIdx = queue.findIndex(i => i.active);
            const prevIdx = currentIdx <= 0 ? queue.length - 1 : currentIdx - 1;
            if (queue.length) playTrack(prevIdx);
        }

        function toggleShuffle(btn) {
            if (!Premium.isPremium()) {
                Premium.showUpgradeModal('Shuffle Control');
                return;
            }
            isShuffling = !isShuffling;
            btn.classList.toggle('active', isShuffling);
            Utils.toast(isShuffling ? 'Shuffle enabled' : 'Shuffle disabled');
        }

        // Initialize Music State
        document.addEventListener('DOMContentLoaded', () => {
            if (!Premium.isPremium()) {
                // Force Shuffle ON for Free users
                isShuffling = true;
                const shuffleBtn = document.getElementById('shuffle-btn');
                if (shuffleBtn) {
                    shuffleBtn.classList.add('active'); // Visually active
                    shuffleBtn.style.opacity = '0.5'; // Visually locked
                    // Add lock icon overlay or tooltip if desired
                }
            }
        });

        function toggleLoop(btn) {
            isLooping = !isLooping;
            btn.classList.toggle('active', isLooping);
            Utils.toast(isLooping ? 'Loop enabled' : 'Loop disabled');
        }

        function updateVolume(val) {
            document.getElementById('volume-val').textContent = val + '%';
            const icon = document.getElementById('volume-icon');
            if (val == 0) {
                icon.setAttribute('data-lucide', 'volume-x');
            } else if (val < 50) {
                icon.setAttribute('data-lucide', 'volume-1');
            } else {
                icon.setAttribute('data-lucide', 'volume-2');
            }
            lucide.createIcons();
        }

        function addToQueue() {
            const val = document.getElementById('music-url').value.trim();
            if (!val) { Utils.toast('Please enter a URL or search term', 'warning'); return; }

            // Simulate adding
            const names = ['Levitating', 'Save Your Tears', 'Heat Waves', 'As It Was', 'Anti-Hero', 'Flowers'];
            const artists = ['Dua Lipa', 'The Weeknd', 'Glass Animals', 'Harry Styles', 'Taylor Swift', 'Miley Cyrus'];
            const rand = Math.floor(Math.random() * names.length);

            queue.push({
                title: val.startsWith('http') ? names[rand] : val,
                artist: val.startsWith('http') ? artists[rand] : 'Unknown Artist',
                duration: `${Math.floor(Math.random() * 3) + 2}:${Math.floor(Math.random() * 60).toString().padStart(2, '0')}`,
                img: `https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?w=100&q=80`,
                active: false
            });

            document.getElementById('music-url').value = '';
            renderQueue();
            Utils.toast('Added to queue!', 'success');
        }

        function removeFromQueue(idx) {
            if (queue[idx].active) {
                Utils.toast('Cannot remove currently playing track', 'warning');
                return;
            }
            queue.splice(idx, 1);
            renderQueue();
            Utils.toast('Removed from queue', 'info');
        }

        function clearQueue() {
            const activeIdx = queue.findIndex(i => i.active);
            const activeTrack = activeIdx >= 0 ? queue[activeIdx] : null;
            queue.length = 0;
            if (activeTrack) queue.push(activeTrack);
            renderQueue();
            Utils.toast('Queue cleared', 'info');
        }

        function seek(e) {
            const rect = e.currentTarget.getBoundingClientRect();
            const pos = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
            progressPercent = pos * 100;
            currentSeconds = pos * totalSeconds;
            document.getElementById('progress-bar').style.width = progressPercent + '%';
            const mins = Math.floor(currentSeconds / 60);
            const secs = Math.floor(currentSeconds % 60);
            document.getElementById('current-time').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
        }
    </script>
</body>

</html>